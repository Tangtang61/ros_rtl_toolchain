diff -uprN newlib-2.5.0.20170922/config.sub newlib-2.5.0.20170922_ros_rtl/config.sub
--- newlib-2.5.0.20170922/config.sub	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/config.sub	2019-04-12 10:40:02.000000000 +0000
@@ -1533,6 +1533,9 @@ case $os in
 		;;
 	-ios)
 		;;
+	-mcos*)
+		os=-mcos
+		;;
 	-none)
 		;;
 	*)
diff -uprN newlib-2.5.0.20170922/libgloss/aarch64/Makefile.in newlib-2.5.0.20170922_ros_rtl/libgloss/aarch64/Makefile.in
--- newlib-2.5.0.20170922/libgloss/aarch64/Makefile.in	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/libgloss/aarch64/Makefile.in	2019-04-12 10:39:56.000000000 +0000
@@ -83,9 +83,9 @@ CRT0_INSTALL	= install-crt0
 RDIMON_CRT0	= rdimon-crt0${${MULTILIBNAME}}.o
 RDIMON_BSP	= librdimon${${MULTILIBNAME}}.a
 RDIMON_OBJS	= $(patsubst %,rdimon-%,$(OBJS))
-RDIMON_SCRIPTS	= rdimon${${MULTILIBNAME}}.specs \
-		  aem-ve${${MULTILIBNAME}}.specs \
-		  aem-validation${${MULTILIBNAME}}.specs
+RDIMON_SCRIPTS	= elf-rdimon${${MULTILIBNAME}}.specs \
+		  elf-aem-ve${${MULTILIBNAME}}.specs \
+		  elf-aem-validation${${MULTILIBNAME}}.specs
 RDIMON_INSTALL	= install-rdimon
 
 CFLAGS		= -g
diff -uprN newlib-2.5.0.20170922/libgloss/aarch64/syscalls.c newlib-2.5.0.20170922_ros_rtl/libgloss/aarch64/syscalls.c
--- newlib-2.5.0.20170922/libgloss/aarch64/syscalls.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/libgloss/aarch64/syscalls.c	2019-04-12 10:39:56.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 /* Copyright (c) 2009, 2010, 2011, 2012 ARM Ltd.  All rights reserved.
 
  Redistribution and use in source and binary forms, with or without
@@ -862,3 +863,4 @@ __aarch64_angel_elapsed (void)
     return result;
   return block[0];
 }
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/libgloss/libnosys/gettod.c newlib-2.5.0.20170922_ros_rtl/libgloss/libnosys/gettod.c
--- newlib-2.5.0.20170922/libgloss/libnosys/gettod.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/libgloss/libnosys/gettod.c	2019-04-12 10:39:54.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 /*
  * Stub version of gettimeofday.
  */
@@ -24,3 +25,5 @@ _DEFUN (_gettimeofday, (ptimeval, ptimez
 }
 
 stub_warning(_gettimeofday)
+
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/configure newlib-2.5.0.20170922_ros_rtl/newlib/configure
--- newlib-2.5.0.20170922/newlib/configure	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/configure	2019-04-12 11:04:49.000000000 +0000
@@ -1,11 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.68 for newlib 2.5.0.
+# Generated by GNU Autoconf 2.69 for newlib 2.5.0.
 #
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -134,6 +132,31 @@ export LANGUAGE
 # CDPATH.
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
   as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
@@ -167,7 +190,8 @@ if ( set x; as_fn_ret_success y && test
 else
   exitcode=1; echo positional parameters were not saved.
 fi
-test x\$exitcode = x0 || exit 1"
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
   as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
   as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
   eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
@@ -220,21 +244,25 @@ IFS=$as_save_IFS
 
 
       if test "x$CONFIG_SHELL" != x; then :
-  # We cannot yet assume a decent shell, so we have to provide a
-	# neutralization value for shells without unset; and this also
-	# works around shells that cannot unset nonexistent variables.
-	# Preserve -v and -x to the replacement shell.
-	BASH_ENV=/dev/null
-	ENV=/dev/null
-	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-	export CONFIG_SHELL
-	case $- in # ((((
-	  *v*x* | *x*v* ) as_opts=-vx ;;
-	  *v* ) as_opts=-v ;;
-	  *x* ) as_opts=-x ;;
-	  * ) as_opts= ;;
-	esac
-	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
 fi
 
     if test x$as_have_required = xno; then :
@@ -336,6 +364,14 @@ $as_echo X"$as_dir" |
 
 
 } # as_fn_mkdir_p
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
 # as_fn_append VAR VALUE
 # ----------------------
 # Append the text in VALUE to the end of the definition contained in VAR. Take
@@ -457,6 +493,10 @@ as_cr_alnum=$as_cr_Letters$as_cr_digits
   chmod +x "$as_me.lineno" ||
     { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -491,16 +531,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -512,28 +552,8 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -1291,8 +1311,6 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1583,9 +1601,9 @@ test -n "$ac_init_help" && exit $ac_stat
 if $ac_init_version; then
   cat <<\_ACEOF
 newlib configure 2.5.0
-generated by GNU Autoconf 2.68
+generated by GNU Autoconf 2.69
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -1661,7 +1679,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -1861,7 +1879,7 @@ This file contains any messages produced
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by newlib $as_me 2.5.0, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
 
@@ -2627,7 +2645,7 @@ case $as_dir/ in #((
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -2796,7 +2814,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2836,7 +2854,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2887,7 +2905,7 @@ do
   test -z "$as_dir" && as_dir=.
     for ac_prog in mkdir gmkdir; do
 	 for ac_exec_ext in '' $ac_executable_extensions; do
-	   { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; } || continue
+	   as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext" || continue
 	   case `"$as_dir/$ac_prog$ac_exec_ext" --version 2>&1` in #(
 	     'mkdir (GNU coreutils) '* | \
 	     'mkdir (coreutils) '* | \
@@ -2940,7 +2958,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AWK="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3268,7 +3286,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3436,7 +3454,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -3614,7 +3632,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AS="${ac_tool_prefix}as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3654,7 +3672,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AS="as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3706,7 +3724,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AR="${ac_tool_prefix}ar"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3746,7 +3764,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AR="ar"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3798,7 +3816,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3838,7 +3856,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3890,7 +3908,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_READELF="${ac_tool_prefix}readelf"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3930,7 +3948,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_READELF="readelf"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4113,7 +4131,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -4243,7 +4261,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AWK="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4289,7 +4307,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AS="${ac_tool_prefix}as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4329,7 +4347,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AS="as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4381,7 +4399,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4421,7 +4439,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4473,7 +4491,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4513,7 +4531,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4635,7 +4653,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4675,7 +4693,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4728,7 +4746,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4769,7 +4787,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -4827,7 +4845,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4871,7 +4889,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5317,8 +5335,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -5547,7 +5564,7 @@ do
     for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -5613,7 +5630,7 @@ do
     for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -5680,7 +5697,7 @@ do
     for ac_prog in fgrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_FGREP" && $as_test_x "$ac_path_FGREP"; } || continue
+      as_fn_executable_p "$ac_path_FGREP" || continue
 # Check for GNU ac_path_FGREP and select it if it is found.
   # Check for GNU $ac_path_FGREP
 case `"$ac_path_FGREP" --version 2>&1` in
@@ -5936,7 +5953,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5980,7 +5997,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6320,7 +6337,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6360,7 +6377,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6637,7 +6654,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AR="${ac_tool_prefix}ar"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6677,7 +6694,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AR="ar"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6742,7 +6759,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6782,7 +6799,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6841,7 +6858,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6881,7 +6898,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7471,7 +7488,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7511,7 +7528,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7563,7 +7580,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7603,7 +7620,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_NMEDIT="nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7655,7 +7672,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7695,7 +7712,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_LIPO="lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7747,7 +7764,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7787,7 +7804,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL="otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7839,7 +7856,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7879,7 +7896,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL64="otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11822,7 +11839,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11825 "configure"
+#line 11842 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11928,7 +11945,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11931 "configure"
+#line 11948 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -13234,16 +13251,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -13303,28 +13320,16 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -13346,7 +13351,7 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_wri
 # values after options handling.
 ac_log="
 This file was extended by newlib $as_me 2.5.0, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -13412,10 +13417,10 @@ cat >>$CONFIG_STATUS <<_ACEOF || ac_writ
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 newlib config.status 2.5.0
-configured by $0, generated by GNU Autoconf 2.68,
+configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -13506,7 +13511,7 @@ fi
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
diff -uprN newlib-2.5.0.20170922/newlib/configure.host newlib-2.5.0.20170922_ros_rtl/newlib/configure.host
--- newlib-2.5.0.20170922/newlib/configure.host	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/configure.host	2019-04-12 10:39:57.000000000 +0000
@@ -571,6 +571,10 @@ case "${host}" in
   z8k-*-coff)
 	sys_dir=z8ksim
 	;;
+  *-mcos*)
+	sys_dir=mcos
+	posix_dir=posix
+	;;
 esac
 
 # Host specific flag settings -- usually for features that are not
@@ -625,6 +629,11 @@ case "${host}" in
 	newlib_cflags="${newlib_cflags} -DNO_EXEC"
 	syscall_dir=syscalls
 	;;
+  aarch64*-*-mcos*)
+	newlib_cflags="${newlib_cflags} -D__mcos__ -D_MCOS_ROS_RTL -D_MCOS_SOURCE -DHAVE_INITFINI_ARRAY -DREENTRANT_SYSCALLS_PROVIDED -DMISSING_SYSCALL_NAMES -DMALLOC_PROVIDED -DHAVE_OPENDIR -DHAVE_RENAME -D_LDBL_EQ_DBL"
+	default_newlib_io_long_long="yes"
+	syscall_dir=
+	;;
   aarch64*-*-*)
 	default_newlib_io_long_long="yes"
 	syscall_dir=syscalls
diff -uprN newlib-2.5.0.20170922/newlib/libc/locale/nl_langinfo.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/locale/nl_langinfo.c
--- newlib-2.5.0.20170922/newlib/libc/locale/nl_langinfo.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/locale/nl_langinfo.c	2019-04-12 10:40:00.000000000 +0000
@@ -288,6 +288,7 @@ do_codeset:
 	case ABMON_9: case ABMON_10: case ABMON_11: case ABMON_12:
 		ret = (char*) __get_time_locale (locale)->mon[_REL(ABMON_1)];
 		break;
+# if !defined(__mcos__)
 	case ERA:
 		ret = (char*) __get_time_locale (locale)->era;
 		break;
@@ -306,6 +307,7 @@ do_codeset:
 	case _DATE_FMT:	/* GNU extension */
 		ret = (char*) __get_time_locale (locale)->date_fmt;
 		break;
+#endif /* # if !defined(__mcos__) */
 	case RADIXCHAR:
 		ret = (char*) __get_numeric_locale (locale)->decimal_point;
 		break;
@@ -361,9 +363,11 @@ do_codeset:
 			}
 		}
 		break;
+# if !defined(__mcos__)
 	case D_MD_ORDER:        /* local extension */
 		ret = (char *) __get_time_locale (locale)->md_order;
 		break;
+#endif /* # if !defined(__mcos__) */
 #ifdef __HAVE_LOCALE_INFO__
 	case _NL_CTYPE_MB_CUR_MAX:
 		ret = (char *) __get_ctype_locale (locale)->mb_cur_max;
diff -uprN newlib-2.5.0.20170922/newlib/libc/posix/posix_spawn.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/posix/posix_spawn.c
--- newlib-2.5.0.20170922/newlib/libc/posix/posix_spawn.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/posix/posix_spawn.c	2019-04-12 10:40:00.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 /*-
  * Copyright (c) 2008 Ed Schouten <ed@FreeBSD.org>
  * All rights reserved.
@@ -575,3 +576,4 @@ _DEFUN(posix_spawnattr_setsigmask, (sa,
 }
 
 #endif  /* !_NO_POSIX_SPAWN */
+#endif  /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/search/hash.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/search/hash.c
--- newlib-2.5.0.20170922/newlib/libc/search/hash.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/search/hash.c	2019-04-12 10:40:02.000000000 +0000
@@ -344,7 +344,11 @@ init_hash(hashp, file, info)
 		if (stat(file, &statbuf))
 #endif
 			return (NULL);
+#if defined(__mcos__)
+		hashp->BSIZE = 1024;
+#else  /* if defined(__mcos__) */
 		hashp->BSIZE = statbuf.st_blksize;
+#endif /* if defined(__mcos__) */
 		hashp->BSHIFT = __log2(hashp->BSIZE);
 	}
 
diff -uprN newlib-2.5.0.20170922/newlib/libc/signal/signal.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/signal/signal.c
--- newlib-2.5.0.20170922/newlib/libc/signal/signal.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/signal/signal.c	2019-04-12 10:39:57.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 /*
 FUNCTION
 <<signal>>---specify handler subroutine for a signal
@@ -238,3 +239,5 @@ _DEFUN (__sigtramp, (sig), int sig)
 #endif
 
 #endif /* !SIGNAL_PROVIDED */
+
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/stdlib/abort.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/abort.c
--- newlib-2.5.0.20170922/newlib/libc/stdlib/abort.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/abort.c	2019-04-12 10:40:00.000000000 +0000
@@ -59,6 +59,9 @@ _DEFUN_VOID (abort)
 
   while (1)
     {
+#if defined(__mcos__)
+      if(getenv("MCOS_TEST_ABORT_SIGABRT_OFF") == NULL)
+#endif /* #if defined(__mcos__) */
       raise (SIGABRT);
       _exit (1);
     }
diff -uprN newlib-2.5.0.20170922/newlib/libc/stdlib/efgcvt.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/efgcvt.c
--- newlib-2.5.0.20170922/newlib/libc/stdlib/efgcvt.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/efgcvt.c	2019-04-12 10:40:00.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 /*
 FUNCTION
 <<ecvt>>, <<ecvtf>>, <<fcvt>>, <<fcvtf>>---double or float to string
@@ -206,3 +207,4 @@ _DEFUN (gcvt, (d, ndigit, buf),
   }
   return (_gcvt (_REENT, d, ndigit, buf, 'g', 0) ? tbuf : 0);
 }
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/stdlib/mbtowc_r.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/mbtowc_r.c
--- newlib-2.5.0.20170922/newlib/libc/stdlib/mbtowc_r.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/mbtowc_r.c	2019-04-12 10:40:00.000000000 +0000
@@ -38,7 +38,7 @@ _DEFUN (__ascii_mbtowc, (r, pwc, s, n, s
   if (n == 0)
     return -2;
 
-#ifdef __CYGWIN__
+#if defined(__CYGWIN__) || defined(__mcos__)
   if ((wchar_t)*t >= 0x80)
     {
       r->_errno = EILSEQ;
diff -uprN newlib-2.5.0.20170922/newlib/libc/stdlib/random.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/random.c
--- newlib-2.5.0.20170922/newlib/libc/stdlib/random.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/stdlib/random.c	2019-04-12 10:40:00.000000000 +0000
@@ -56,8 +56,13 @@ algorithm as <<rand>>.
 #include <stdlib.h>
 #include <reent.h>
 
+#if defined(__mcos__)
+void
+_DEFUN (srandom, (seed), unsigned long seed)
+#else /* #if defined(__mcos__) */
 void
 _DEFUN (srandom, (seed), unsigned int seed)
+#endif /* #if defined(__mcos__) */
 {
   struct _reent *reent = _REENT;
 
diff -uprN newlib-2.5.0.20170922/newlib/libc/string/strerror.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/string/strerror.c
--- newlib-2.5.0.20170922/newlib/libc/string/strerror.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/string/strerror.c	2019-04-12 10:40:02.000000000 +0000
@@ -904,9 +904,11 @@ _DEFUN(strerror, (int),
   return _strerror_r (_REENT, errnum, 0, NULL);
 }
 
+#if !defined(__mcos__)
 char *
 strerror_l (int errnum, locale_t locale)
 {
   /* We don't support per-locale error messages. */
   return _strerror_r (_REENT, errnum, 0, NULL);
 }
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/string/strerror_r.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/string/strerror_r.c
--- newlib-2.5.0.20170922/newlib/libc/string/strerror_r.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/string/strerror_r.c	2019-04-12 10:40:02.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 /* GNU variant of strerror_r. */
 /*
 FUNCTION
@@ -83,3 +84,5 @@ _DEFUN (strerror_r, (errnum, buffer, n),
     return error;
   return strcpy (buffer, error);
 }
+
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/sys/configure newlib-2.5.0.20170922_ros_rtl/newlib/libc/sys/configure
--- newlib-2.5.0.20170922/newlib/libc/sys/configure	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/sys/configure	2019-04-12 10:39:59.000000000 +0000
@@ -811,7 +811,8 @@ sysvnecv70
 tic80
 tirtos
 w65
-z8ksim'
+z8ksim
+mcos'
 
 # Initialize some variables set by options.
 ac_init_help=
@@ -11456,7 +11457,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11459 "configure"
+#line 11460 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11562,7 +11563,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11565 "configure"
+#line 11566 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11859,6 +11860,8 @@ subdirs="$subdirs a29khif"
  ;;
 	z8ksim) subdirs="$subdirs z8ksim"
  ;;
+	mcos) subdirs="$subdirs mcos"
+ ;;
   esac;
 fi
 
diff -uprN newlib-2.5.0.20170922/newlib/libc/sys/configure.in newlib-2.5.0.20170922_ros_rtl/newlib/libc/sys/configure.in
--- newlib-2.5.0.20170922/newlib/libc/sys/configure.in	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/sys/configure.in	2019-04-12 10:39:57.000000000 +0000
@@ -49,6 +49,7 @@ if test -n "${sys_dir}"; then
 	tirtos) AC_CONFIG_SUBDIRS(tirtos) ;;
 	w65) AC_CONFIG_SUBDIRS(w65) ;;
 	z8ksim) AC_CONFIG_SUBDIRS(z8ksim) ;;
+	mcos) AC_CONFIG_SUBDIRS(mcos) ;;
   esac;
 fi
 
diff -uprN newlib-2.5.0.20170922/newlib/libc/time/lcltime.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/lcltime.c
--- newlib-2.5.0.20170922/newlib/libc/time/lcltime.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/lcltime.c	2019-04-12 10:40:00.000000000 +0000
@@ -43,7 +43,7 @@ ANSI C requires <<localtime>>.
 
 <<localtime>> requires no supporting OS subroutines.
 */
-
+#if !defined(__mcos__)
 #include <stdlib.h>
 #include <time.h>
 #include <reent.h>
@@ -61,3 +61,4 @@ _DEFUN (localtime, (tim_p),
 }
 
 #endif
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/time/lcltime_r.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/lcltime_r.c
--- newlib-2.5.0.20170922/newlib/libc/time/lcltime_r.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/lcltime_r.c	2019-04-12 10:40:00.000000000 +0000
@@ -12,7 +12,7 @@
  * expressed as local time. Returns a pointer to a structure containing the
  * broken-down time.
  */
-
+#if !defined(__mcos__)
 #include "local.h"
 
 struct tm *
@@ -125,3 +125,4 @@ _DEFUN (localtime_r, (tim_p, res),
 
   return (res);
 }
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/time/mktime.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/mktime.c
--- newlib-2.5.0.20170922/newlib/libc/time/mktime.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/mktime.c	2019-04-12 10:40:00.000000000 +0000
@@ -46,7 +46,7 @@ ANSI C requires <<mktime>>.
 
 <<mktime>> requires no supporting OS subroutines.
 */
-
+#if !defined(__mcos__)
 #include <stdlib.h>
 #include <time.h>
 #include "local.h"
@@ -287,3 +287,4 @@ _DEFUN(mktime, (tim_p),
 	
   return tim;
 }
+#endif /* #if !defined(__mcos__) */
diff -uprN newlib-2.5.0.20170922/newlib/libc/time/strftime.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/strftime.c
--- newlib-2.5.0.20170922/newlib/libc/time/strftime.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/strftime.c	2019-04-12 10:40:00.000000000 +0000
@@ -277,7 +277,7 @@ BUGS
 (NOT Cygwin:) <<strftime>> ignores the LC_TIME category of the current
 locale, hard-coding the "C" locale settings.
 */
-
+#if !defined(__mcos__)
 #include <newlib.h>
 #include <sys/config.h>
 #include <stddef.h>
@@ -1934,3 +1934,4 @@ printf(" %d test cases.\n", tot);
 return(errr || erro);
 }
 #endif /* defined(_REGRESSION_TEST) ] */
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/time/tzset.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/tzset.c
--- newlib-2.5.0.20170922/newlib/libc/time/tzset.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/tzset.c	2019-04-12 10:40:00.000000000 +0000
@@ -61,6 +61,7 @@ PORTABILITY
 
 Supporting OS subroutine required: None
 */
+#if !defined(__mcos__)
 
 #include <_ansi.h>
 #include <reent.h>
@@ -80,3 +81,4 @@ _DEFUN_VOID (tzset)
   _tzset_unlocked_r (_REENT);
   TZ_UNLOCK;
 }
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
diff -uprN newlib-2.5.0.20170922/newlib/libc/time/tzset_r.c newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/tzset_r.c
--- newlib-2.5.0.20170922/newlib/libc/time/tzset_r.c	2017-09-19 20:36:12.000000000 +0000
+++ newlib-2.5.0.20170922_ros_rtl/newlib/libc/time/tzset_r.c	2019-04-12 10:40:00.000000000 +0000
@@ -1,3 +1,4 @@
+#if !defined(__mcos__)
 #include <_ansi.h>
 #include <reent.h>
 #include <stdio.h>
@@ -191,3 +192,4 @@ _DEFUN (_tzset_r, (reent_ptr),
   _tzset_unlocked_r (reent_ptr);
   TZ_UNLOCK;
 }
+#endif /* #if !defined(__mcos__) */
\ No newline at end of file
